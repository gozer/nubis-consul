#!/bin/bash

DIRNAME=`dirname $0`
DIR=`cd $DIRNAME && pwd`
OPENSSL_CFG=$DIR/openssl.cnf

DROPDIR=.

KEY=$DROPDIR/consul.key
CERT=$DROPDIR/consul.pem
SECRET=$DROPDIR/consul.secret

if [ ! -f "$KEY" ] || [ ! -f "$CERT" ]; then
 echo "Generating SSL key"
  openssl req -new \
    -x509 -nodes \
    -extensions consul \
    -config $OPENSSL_CFG \
     -out  consul.pem \
     -keyout consul.key \
     -days 3650 \
     -subj '/CN=www.wiki.prod.nubis.allizom.org'
fi

if [ ! -f "$SECRET" ]; then
  consul keygen > $SECRET
fi
